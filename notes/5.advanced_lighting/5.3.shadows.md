# 5.3.1 Shadow Mapping

## 原理

从光源视角渲染一遍场景，记录下最近片段的距离（通过深度缓冲实现），接着进行正常的渲染，每个片段到光源的距离如果大于最近距离则判定为在阴影中。

## 问题和解决

### Shadow Acne

简单 Shadow Mapping 实现时会看到的摩尔纹，原因是从光源视角渲染的 shadow map 分辨率不够，用作阴影距离参考时容易出现一个 texel 覆盖的片段有的判定在阴影中有的不在。

可以在判定阴影的时候加一个偏移距离来抵消 shadow map 的锯齿。更好的办法是使用一个自适应的偏移，相对光源倾斜的表面使用大偏移量，垂直于光源的表面使用小偏移量。

## 其他问题

model 矩阵记得变化。MVP 矩阵的含义。

`gl_Position` 从顶点着色器接收的坐标会自行做一次透视除法。不使用这个变量接收的坐标要注意自己做一次。

光源矩阵是世界空间到光源视角空间的映射，注意要应用在顶点的世界坐标上。