# 1.8 坐标系

OpenGL 下的几个坐标系概念。

1. 局部空间，对于每个被视为整体的对象，其内部拥有一个独立的坐标系，对象的顶点坐标都是相对于这个坐标系的。
2. 世界空间，整个 OpenGL 的“场景”所在，在世界空间中每个物体都拥有一个坐标，即物体的局部坐标系原点在“场景”中的位置。
3. 观察空间，其坐标系以相机为原点，相机朝向为 Z 轴负方向、相机正上方为 Y 轴正方向的右手系。
4. 裁剪空间，即 NDC 空间。OpenGL 意图使裁剪空间为一个单位立方体，立方体之外的片段不予显示。

从局部空间到世界空间的变换矩阵为模型（Model）矩阵，指示物体如何通过线性变换到达世界空间的指定位置。模型矩阵一般在布置场景时确定。

从世界空间到观察空间的变换矩阵为观察（View）矩阵，将世界坐标变换到观察空间（相机空间）下的坐标。观察矩阵只需要相机的外参即可确定。

从观察空间到裁剪空间的变换矩阵为投影（Projection）矩阵，它将观察空间下的坐标通过正交（Orthographic）投影或透视（Perspective）投影变换到一个单位立方体内。投影矩阵的数值取决于投影方式、视平面（投影平面）的尺寸（主要是宽高比）和位置（用于确定 frustum）。这两种矩阵都有一定量的推导，但是 glm 封装了创建过程。

所有的变换结束后，齐次坐标将转为 3D 坐标。

可以通过调用 glm 的变换函数来构造以上矩阵，注意函数的调用顺序和对应（行主序）矩阵的应用顺序是相反的，先调用的变换会后应用在坐标上，也就是说调用顺序按照正常的公式书写顺序来即可。但在 shader 里面的顺序还是应该遵照矩阵乘法。

关于坐标系的手性，在 NDC 和默认的深度测试中，z 坐标越大代表深度越大，因此可以认为 NDC 是左手系，而之前的所有坐标系，都是可以由用户指定的，不分手性。但是，glm 默认使用右手系，因此之前的空间坐标都倾向于使用右手系。

程序实现上，目前还是在 shader 外使用 glm 构建矩阵，然后 uniform 到 shader 里的对应变量来应用变换。

注意渲染多个立体面时启用深度缓冲，并在渲染循环的开始清楚缓冲区（`GL_DEPTH_BUFFER_BIT`）。
